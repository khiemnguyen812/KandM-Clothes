@model KandM_Clothes.Models.EF.Order
@{
    ViewBag.Title = "Thanh toán";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<link href="~/Content/assets/styles/main_styles.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="~/Content/assets/styles/categories_styles.css">
<link rel="stylesheet" type="text/css" href="~/Content/assets/styles/categories_responsive.css">


<div class="container product_section_container">
    <div class="row">
        <div class="col product_section clearfix">

            <!-- Breadcrumbs -->

            <div class="breadcrumbs d-flex flex-row align-items-center">
                <ul>
                    <li><a href="/home">Home</a></li>
                    <li class="active"><a href="/gio-hang"><i class="fa fa-angle-right" aria-hidden="true"></i>Giỏ hàng</a></li>
                    <li class="active"><a href="#"><i class="fa fa-angle-right" aria-hidden="true"></i>Thanh toán</a></li>

                </ul>
            </div>

            <div class="col-md-12 text-center">
                <h1>Thanh toán</h1>
                <p>Vui lòng kiểm tra lịa thông tin đơn hàng!</p>
            </div>

            @*Main content*@
            <div class="row">
                <div class="col-md-8">
                    <h3>Thông tin khách hàng</h3>
                    <div class="form-group">
                        <label for="customerName">Họ tên khách hàng:</label>
                        <input type="text" class="form-control" id="customerName" name="customerName" required>
                    </div>
                    <div class="form-group">
                        <label for="phoneNumber">Số điện thoại:</label>
                        <input type="text" class="form-control" id="phoneNumber" name="phoneNumber" required>
                    </div>
                    <div class="form-group">
                        <label for="address">Địa chỉ:</label>
                        <input type="text" class="form-control" id="address" name="address" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email:</label>
                        <input type="email" class="form-control" id="email" name="email" required>
                        <div id="result"></div>
                    </div>
                    <button type="submit" class="btn btn-block btn-success">Đặt hàng</button>
                </div>
                <div class="col-md-4">
                    <h3>Giỏ hàng</h3>
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>Tên sản phẩm</th>
                                <th>Thành tiền</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (Model != null && Model.items.Any())
                            {
                                foreach (var item in Model.items)
                                {
                                    <tr>
                                        <td>@item.Product.Title</td>
                                        <td class="totalProductPrice">@(item.Product.Price * item.Quantity)</td>
                                    </tr>
                                }
                                <tr>
                                    <td class="text-left">Tổng tiền:</td>
                                    <td id="TotalPrice"></td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>

        </div>
    </div>
</div>

@section scripts{
    <script src="~/Content/assets/js/categories_custom.js"></script>
    <script>
        function calculateTotalPrice() {
            var total = 0;
            $("tbody tr").each(function () {
                var totalProductPrice = parseInt($(this).find('.totalProductPrice').text());
                if (isNaN(totalProductPrice)) {
                    totalProductPrice = 0;
                }
                console.log(totalProductPrice);
                total += totalProductPrice;
            });
            $('#TotalPrice').text(total + ',00');
        }

        const validateEmail = (email) => {
            return email.match(
                /^(([^<>()[\]\\.,;:\s@@\"]+(\.[^<>()[\]\\.,;:\s@@\"]+)*)|(\".+\"))@@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/
            );
        };

        const validate = () => {
            const $result = $('#result');
            const email = $('#email').val();
            $result.text('');

            if (validateEmail(email)) {
                $result.text('Valid.');
                $result.css('color', 'green');
            } else {
                $result.text('Invalid.');
                $result.css('color', 'red');
            }
            return false;
        }

        $('#email').on('input', validate);
        $(document).ready(function () {
            calculateTotalPrice();
        });
    </script>
}